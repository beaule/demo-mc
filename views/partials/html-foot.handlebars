<!-- Bootstrap core JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
<!-- Third party plugin JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>

<script>
  function copyToClipboard(id) {
    /* Get the text field */
    var copyText = document.getElementById(id);
    var changeType = false;
    if (copyText.type == "password") {
      changeType = true;
      copyText.type = "text;"
    }

    /* Select the text field */
    copyText.select();
    copyText.setSelectionRange(0, 99999); /*For mobile devices*/
    /* Copy the text inside the text field */
    document.execCommand("copy");
    if (changeType)
      copyText.type = "password"
  }
  function queryDigitalProfile(endPoint) {
    $.ajax({
      url: '/' + endPoint + "DigitalTwin",
      type: 'GET',
      dataType: "json",
      success: function (response, statut) {
        var svg = d3.select("#svg1").append("svg");
        $("#" + endPoint + "Response").text(JSON.stringify(response, undefined, 4));
      },
      error: function (resultat, statut, erreur) {
        alert(statut + " " + resultat + " " + erreur)
      },
      complete: function (resultat, statut) {
        //empty
      }
    });
  }

  $(document).ready(function () {
    // On reprend le même id que dans le précédent chapitre

    $("#simpleQuery").click(function () {
      queryDigitalProfile("simpleQuery");
    });

    $("#advancedQuery").click(function () {
      queryDigitalProfile("advancedQuery");
    });
  });


  // Themes begin
  am4core.useTheme(am4themes_animated);
  // Themes end

  // Create chart instance
  var chart = am4core.create("chartdiv", am4charts.PieChart);
  chart.startAngle = 160;
  chart.endAngle = 380;

  // Let's cut a hole in our Pie chart the size of 40% the radius
  chart.innerRadius = am4core.percent(40);

  // Add data
  chart.data = [{
    "intensity": "Elevé",
    "duration": {{ intensityVigorous }}
  }, {
    "intensity": "Modéré",
    "duration": {{ intensityModerate }}
  }, {
    "intensity": "Faible",
    "duration": {{ intensityLow }}
  }];

  // Add and configure Series
  var pieSeries = chart.series.push(new am4charts.PieSeries());
  pieSeries.dataFields.value = "duration";
  pieSeries.dataFields.category = "intensity";
  pieSeries.slices.template.stroke = new am4core.InterfaceColorSet().getFor("background");
  pieSeries.slices.template.strokeWidth = 1;
  pieSeries.slices.template.strokeOpacity = 1;

  // Disabling labels and ticks on inner circle
  pieSeries.labels.template.disabled = true;
  pieSeries.ticks.template.disabled = false;

  // Disable sliding out of slices
  pieSeries.slices.template.states.getKey("hover").properties.shiftRadius = 0;
  pieSeries.slices.template.states.getKey("hover").properties.scale = 1;
  pieSeries.radius = am4core.percent(40);
  pieSeries.innerRadius = am4core.percent(30);

  var cs = pieSeries.colors;
  cs.list = [am4core.color(new am4core.ColorSet().getIndex(0))];

  cs.stepOptions = {
    lightness: -0.05,
    hue: 0
  };
  cs.wrap = false;


  // Add second series
  var pieSeries2 = chart.series.push(new am4charts.PieSeries());
  pieSeries2.dataFields.value = "duration";
  pieSeries2.dataFields.category = "intensity";
  pieSeries2.slices.template.stroke = new am4core.InterfaceColorSet().getFor("background");
  pieSeries2.slices.template.strokeWidth = 1;
  pieSeries2.slices.template.strokeOpacity = 1;
  pieSeries2.slices.template.states.getKey("hover").properties.shiftRadius = 0.05;
  pieSeries2.slices.template.states.getKey("hover").properties.scale = 1;

  pieSeries2.labels.template.disabled = true;
  pieSeries2.ticks.template.disabled = true;


  var label = chart.seriesContainer.createChild(am4core.Label);
  label.textAlign = "middle";
  label.horizontalCenter = "middle";
  label.verticalCenter = "middle";
  label.adapter.add("text", function (text, target) {
    return "[bold font-size:30px]" + pieSeries.dataItem.values.value.sum + " heures \nd'activité physique \nen {{year}}.[/]";
  })



</script>
{{ intensityVigorous }}